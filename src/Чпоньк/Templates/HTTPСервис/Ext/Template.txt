&Вместо("{Обработчик}")
Функция Чпоньк_{Обработчик}(Запрос)
	
	Заголовки = Запрос.Заголовки;
	
	Если НРег(Заголовки["User-Agent"]) = "chponk" Тогда
		
		ПараметрыЗапроса = Запрос.ПараметрыЗапроса;
		Событие = ПараметрыЗапроса["event"];
		ТелоЗапроса = Запрос.ПолучитьТелоКакСтроку();
		
		Если Не ЗначениеЗаполнено(ТелоЗапроса) Тогда
			
			Результат = Новый HTTPСервисОтвет(400);
			Результат.УстановитьТелоИзСтроки(СтрШаблон("%1 - %2 не выполнено. Пустое тело запроса.", Формат(ТекущаяДатаСеанса(), "ДЛФ=T"), Событие));
			Возврат Результат;
			
		Иначе
			
			Результат = Новый HTTPСервисОтвет(200);
			Результат.УстановитьТелоИзСтроки(СтрШаблон("%1 - %2 выполнено",  Формат(ТекущаяДатаСеанса(), "ДЛФ=T"), Событие));
			
		КонецЕсли;
		
		ЧтениеJSON = Новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(ТелоЗапроса);
		Значение = ПрочитатьJSON(ЧтениеJSON);
		ЧтениеJSON.Закрыть();
		
		Если Событие = "ФайлУдален" Тогда
			КодОбработки = СтрШаблон("Чпоньк.%1(Значение.file);", Событие);
		ИначеЕсли Событие = "ФайлИзменен" Тогда
			КодОбработки = СтрШаблон("Чпоньк.%1(Значение.file, Значение.content);", Событие);
		КонецЕсли;
		
		Выполнить(КодОбработки);
		
	Иначе
		
		Результат = ПродолжитьВызов(Запрос);
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции
